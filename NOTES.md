
##### Постановка задачи (какую проблему я решаю):

1. Заполнить пассажирами как можно больше мест в моих поездах / продать как можно билетов.
2. Избежать ситуации, когда более одного билета продается на одно и то же место.
3. Предоставить информацию о наличии свободных мест / билетов в форме, которая имеет смысл для пассажира или кассира. Пассажира интересует (первый уровень выбора): пункт отправления, пункт назначения, дата отправления, также (второй уровень сортировки): уровень комфорта, цена (зависит от класса и поезда), время суток отправления и прибытия, время в пути)


Сущности, их характеристики и взаимосвязи (какие предметы и явления участвуют в процессе, что мне необходимо координировать):

1. Место - физический диванчик, на котором может поместиться поместиться один пассажир в оин и тот же момент времени.
- принадлежит к вагону
- может ли существовать без других сущностей? -- не может без вагона (для меня как для дизайнера базы данных)

2. Вагон: тележка, имеющая места и приналежая к поезду.
- имеет класс или тип
- принадлежит к поезду (одному в единицу времени)
- имеет одно или более мест
- может ли существовать без других сущностей? -- да (вполне вероятно, вагон можно отцепить от одного поезда и прицепить к другому, к нему можно назначить проводника, его нужно технически обслуживать, на какое-то время поставить в депо и т.д.)

3. Поезд: сочетание физических вагонов, паровоза и идеи (название, номер), плюс определенная маркетинговая мифология
- всегда имеет название или номер, может иметь другие нефизические свойства
- включает ноль или более вагонов (напр., ноль в межсезонье)
- может ли существовать без других сущностей? -- да (поезд может быть сезонным, может переводиться с одного маршрута на другой)
- связан с маршрутом посредством расписания

4. Маршрут: откуда и куда едет поезд, отрезок на карте.
- всегда имеет начальную и конечную географическую точка (станцию)
- всегда имеет ноль или более промежуточных станций
- может ли существовать без других сущностей (кроме станций)? -- да (маршрут может быть запланированным, но не запущенным, или же каким-нибудь сезонным)
- связан с поездами посредством "расписания"


5. Расписание -- уникальное сочетании станции, поезда, маршрута и точки во времени
- не существует само по себе
- всегда имеет один маршрут
- всегда имеет один поезд
- всегда имеет одну точку во времени
- всегда имеет одну станцию
*- напр., расписание поездов по конретному маршруту является видом такой таблицы: выбрать маршрут + сгруппировать по поездам = коллекция станций с названием и временем, в которое каждый поезд их проходит 
- если принять во внимание, что поезд не отправляется в ту же секунду, когда прибывает, нужен "тип события" - т.е., отправление или прибытие

6. Перегон = Отрезок поездки: кратчайший отрезок между станциями на пути следования поезда, где начало пути во времени раньше, чем конец. Минимальное расстояние (географическое и временное), на которое можно продать билет.

"занятость мест" - бронирование

- имеет начало и конец во времени (timestamp)
- имеет начало и конец в пространстве (станции)
- может быть или доступным, или забронированным
- обязательно принадлежит к Месту (один Сегмент - одно Место)
-* минимальная имплемантация: записывать только занятые отрезки, то есть, наличие записи означает, что отрезок занят

гарантия: сюда вносится каждый отрезок пути на каждое место в вагоне и поезде, следующему по поеределенному маршруту.


7. Сегмент расписания: любой длины отрезок между станциями на пути следования, где начало пути во времени раньше, чем конец. Группировка отрезков по критерию, интересующему пассажира и по критерию осуществимости. Потенциальный билет.

"наличие билетов"

- имеет начало и конец во времени
- имеет начало и конец в пространстве
- обязательно состоит из одного или нескольких соседних отрезков
- является доступным, если все входящие в него отрезки доступны
- для пассажира, символизирует наличие "свободного места"

- имеет начало и конец во времени 
- имеет начало и конец в пространстве
	- выбрать из Расписания записи, где один и тот же поезд и маршрут, в списке станций которого есть две требуемые, и где станция прибытия поезже во времени, чем требуемая станция отправления

- обязательно состоит из одного или нескольких соседних отрезков 
	- в минимальной имплементации, по умолчанию
- является доступным, если все входящие в него отрезки доступны
	- из выбранныз записей выбрать все места, не имеющие отрезков в списке забронированных
- для пассажира, символизирует наличие "свободного места"


8. Станция
- имеет идентификатор, название, географические свойства, имеющие смысл для поиска (например, в одном городе может быть несколько вокзалов с разными названиями, и наоборот -- один козал может обслуживать несколько соседних населеднных пунктов). Также может содержать координаты для рассчета расстояний, может быть участвовать в ценообразовании.

9. Билет
уникальное сочетание пассажира и сегмента (со всем, что в него входит)



Процесс:
т.е., чтобы начать продавать билеты на поезд, мне нужно:
1) создать поезд
2) создать маршрут, добавить начальную, конечную и промежуточные добавить станции 
3) создать вагоны, добавить к поезду
4) создать места, добавить к вагонам
5) добавить каждый станцию маршрута и поезд к расписанию, с временем


Чтобы показать свободные места: 

При продаже билета (Сегмента), в "занятость мест" записывается:
- место, время отпр, ст. отпр., время приб., ст. приб., пассажир, время бронирования


